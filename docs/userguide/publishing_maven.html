<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>第六十五章. Maven 发布（新） - Chapter&nbsp;65.&nbsp;Maven Publishing (new)</title>
  <link xmlns:xslthl="http://xslthl.sf.net" type="text/css" rel="stylesheet" href="base.css">
  <link xmlns:xslthl="http://xslthl.sf.net" type="text/css" rel="stylesheet" href="docs.css">
  <link xmlns:xslthl="http://xslthl.sf.net" type="text/css" rel="stylesheet" href="userguide.css">
  <meta content="DocBook XSL Stylesheets V1.75.2" name="generator">
  <link rel="home" href="userguide.html" title="Gradle 用户指南">
  <link rel="up" href="userguide.html" title="Gradle 用户指南">
  <link rel="prev" href="publishing_ivy.html" title="第六十四章. Ivy发布（新）">
  <link rel="next" href="sample_list.html" title="附录&nbsp;A.&nbsp;Gradle 示例">
 </head>
 <body>
  <div class="navheader">
   <div>
    <div class="navbar">
     <a xmlns:xslthl="http://xslthl.sf.net" href="publishing_ivy.html" title="第六十四章. Ivy发布（新）">上一章</a>
     <span>|</span>
     <a xmlns:xslthl="http://xslthl.sf.net" href="userguide.html" title="Gradle 用户指南">目录</a>
     <span>|</span>
     <a xmlns:xslthl="http://xslthl.sf.net" href="sample_list.html" title="附录&nbsp;A.&nbsp;Gradle 示例">下一章</a>
    </div>
   </div>
  </div>
  <div class="chapter">
   <div class="titlepage">
    <div>
     <div>
      <h1 xmlns:xslthl="http://xslthl.sf.net"><a name="publishing_maven"></a>第六十五章. Maven 发布（新）</h1>
      <h3 xmlns:xslthl="http://xslthl.sf.net"><a name="publishing_maven"></a>Chapter&nbsp;65.&nbsp;Maven Publishing (new)</h3>
     </div>
    </div>
   </div>
   <div class="note">
    <p> 本章内容描述了一个新的 <a class="link" href="feature_lifecycle.html">孵化中的</a> 功能，是由“<code class="literal">maven-publish</code>”插件提供的 maven 发布支持。最终这个新的发布支持将取代通过<code class="literal">Upload</code>任务发布的方式。 <br>This chapter describes the new <a class="link" href="feature_lifecycle.html">incubating</a> Maven publishing support provided by the “<code class="literal">maven-publish</code>” plugin. Eventually this new publishing support will replace publishing via the <code class="literal">Upload</code> task.</p>
    <p> 如果你正在查找有关使用 <code class="literal">Upload</code> 任务的原始的 Maven 发布支持的文档，请查阅《<a class="xref" href="artifact_management.html">第五十一章，<i>发布工件</i></a>》。 <br>If you are looking for documentation on the original Maven publishing support using the <code class="literal">Upload</code> task please see <a class="xref" href="artifact_management.html">Chapter&nbsp;51, <i>Publishing artifacts</i></a>.</p>
   </div>
   <p> 本章介绍如何将构建工件发布到 <a class="ulink" href="http://maven.apache.org/" target="_top">Apache Maven</a> 仓库。发布到 Maven 仓库的模块可以被 Maven、Gradle（参见《<a class="xref" href="dependency_management.html">第 50 章，<i>依赖管理</i></a>》）和其他理解 Maven 仓库格式的工具使用。 <br>This chapter describes how to publish build artifacts to an <a class="ulink" href="http://maven.apache.org/" target="_top">Apache Maven</a> Repository. A module published to a Maven repository can be consumed by Maven, Gradle (see <a class="xref" href="dependency_management.html">Chapter&nbsp;50, <i>Dependency Management</i></a>) and other tools that understand the Maven repository format.</p>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="N16F3D"></a>65.1. “<code class="literal">maven-publish</code>”插件</h2>
       <h4 class="title"><a name="N16F3D"></a>65.1.&nbsp;The “<code class="literal">maven-publish</code>” Plugin</h4>
      </div>
     </div>
    </div>
    <p> 使用Maven格式发布的功能，是由 “<code class="literal">maven-publish</code>” 插件提供的。 <br>The ability to publish in the Maven format is provided by the “<code class="literal">maven-publish</code>” plugin.</p>
    <p> “<code class="literal">publishing</code>”项目在“<code class="literal">publishing</code>”项目上创建了一个<a class="ulink" href="../dsl/org.gradle.api.publish.PublishingExtension.html" target="_top"><code class="classname">PublishingExtension</code></a>类型的扩展。这个扩展提供了两个容器，一个叫publications，一个叫repositories。“<code class="literal">maven-publish</code>”插件适用于<a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> publications 和 <a class="ulink" href="../dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html" target="_top"><code class="classname">IvyArtifactRepository</code></a> repositories。 <br>The “<code class="literal">publishing</code>” plugin creates an extension on the project named “<code class="literal">publishing</code>” of type <a class="ulink" href="../dsl/org.gradle.api.publish.PublishingExtension.html" target="_top"><code class="classname">PublishingExtension</code></a>. This extension provides a container of named publications and a container of named repositories. The “<code class="literal">maven-publish</code>” plugin works with <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> publications and <a class="ulink" href="../dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html" target="_top"><code class="classname">MavenArtifactRepository</code></a> repositories.</p>
    <div class="example">
     <a name="publishing_maven:apply_plugin"></a>
     <p class="title"><b>示例 65.1.&nbsp;应用“maven-publish”插件 - Example&nbsp;65.1.&nbsp;Applying the 'maven-publish' plugin</b></p>
     <div class="example-contents">
      <p><code class="filename">build.gradle</code></p>
      <pre class="programlisting">apply plugin: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'maven-publish'</span></pre>
     </div>
    </div>
    <br class="example-break">
    <p> 应用“<code class="literal">maven-publish</code>”插件将执行以下操作： <br>Applying the “<code class="literal">maven-publish</code>” plugin does the following:</p>
    <div class="itemizedlist">
     <ul class="itemizedlist">
      <li class="listitem"> 应用“<code class="literal">publishing</code>”插件 <br>Applies the “<code class="literal">publishing</code>” plugin</li>
      <li class="listitem"> 建立一个规则来为每个添加的<a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code> </a>自动创建一个 <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.GenerateMavenPom.html" target="_top"> <code class="classname">GenerateMavenPom</code></a>任务（见《<a class="xref" href="publishing_maven.html#publishing_maven:publications">第 65.2 节，“发布”</a>》）。 <br>Establishes a rule to automatically create a <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.GenerateMavenPom.html" target="_top"><code class="classname">GenerateMavenPom</code></a> task for each <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> added (see <a class="xref" href="publishing_maven.html#publishing_maven:publications">Section&nbsp;65.2, “Publications”</a>).</li>
      <li class="listitem"> 建立一个规则，来为添加的每一个<a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code> </a>（见《<a class="xref" href="publishing_maven.html#publishing_maven:publications">第 65.2 节，“发布”</a>》）及 <a class="ulink" href="../dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html" target="_top"><code class="classname">MavenArtifactRepository</code></a> (见《<a class="xref" href="publishing_maven.html#publishing_maven:repositories">第&nbsp;65.3 节， “仓库”</a>》）的组合，自动创建一个 <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html" target="_top"> <code class="classname">PublishToMavenRepository</code></a>任务。 <br>Establishes a rule to automatically create a <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html" target="_top"><code class="classname">PublishToMavenRepository</code></a> task for the combination of each <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> added (see <a class="xref" href="publishing_maven.html#publishing_maven:publications">Section&nbsp;65.2, “Publications”</a>), with each <a class="ulink" href="../dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html" target="_top"><code class="classname">MavenArtifactRepository</code></a> added (see <a class="xref" href="publishing_maven.html#publishing_maven:repositories">Section&nbsp;65.3, “Repositories”</a>).</li>
      <li class="listitem"> 建立一个规则，来为添加的每个 <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> （请参见《<a class="xref" href="publishing_maven.html#publishing_maven:publications">第 65.2 节，“发布”</a>》）自动创建一个 <a class="ulink" href="../javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html" target="_top"><code class="classname">PublishToMavenLocal</code></a> 任务。 <br>Establishes a rule to automatically create a <a class="ulink" href="../javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html" target="_top"><code class="classname">PublishToMavenLocal</code></a> task for each <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> added (see<a class="xref" href="publishing_maven.html#publishing_maven:publications">Section&nbsp;65.2, “Publications”</a>).</li>
     </ul>
    </div>
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="publishing_maven:publications"></a>65.2.&nbsp;发布</h2>
       <h4 class="title"><a name="publishing_maven:publications"></a>65.2.&nbsp;Publications</h4>
      </div>
     </div>
    </div>
    <div class="note">
     <p> 如果你不熟悉项目工件和配置，你应该阅读介绍这些概念的《<a class="xref" href="artifact_management.html">第五十一章，<i>发布工件</i></a>》。本章还介绍了使用另一种不同的机制的“发布工件 ”。这里描述的发布功能最终会取代那一功能。 <br>If you are not familiar with project artifacts and configurations, you should read the <a class="xref" href="artifact_management.html">Chapter&nbsp;51, <i>Publishing artifacts</i></a> that introduces these concepts. This chapter also describes “publishing artifacts” using a different mechanism than what is described in this chapter. The publishing functionality described here will eventually supersede that functionality.</p>
    </div>
    <p> Publication对象描述了要创建的发布内容的结构和配置。Publications是通过任务发布到仓库的，发布对象的配置明确地决定了要发布的内容。一个项目的所有publications都会在<a class="ulink" href="../dsl/org.gradle.api.publish.PublishingExtension.html#org.gradle.api.publish.PublishingExtension:publications" target="_top"><code class="classname">PublishingExtension.getPublications()</code></a>容器中定义，每一个publication在项目中都具有唯一名称。 <br>Publication objects describe the structure/configuration of a publication to be created. Publications are published to repositories via tasks, and the configuration of the publication object determines exactly what is published. All of the publications of a project are defined in the <a class="ulink" href="../dsl/org.gradle.api.publish.PublishingExtension.html#org.gradle.api.publish.PublishingExtension:publications" target="_top"><code class="classname">PublishingExtension.getPublications()</code></a> container. Each publication has a unique name within the project.</p>
    <p> 要使“<code class="literal">maven-publish</code>”插件起作用，必须将一个 <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> 添加到publications集合里。这个publication决定了实际要发布的工件，以及在关联的POM文件中包含的详细信息。通过添加组件，自定义工件以及修改生成的POM文件，可以配置一个publication。 <br>For the “<code class="literal">maven-publish</code>” plugin to have any effect, a <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> must be added to the set of publications. This publication determines which artifacts are actually published as well as the details included in the associated POM file. A publication can be configured by adding components, customizing artifacts, and by modifying the generated POM file directly.</p>
    <div class="section">
     <div class="titlepage">
      <div>
       <div>
        <h3 class="title"><a name="N16FC7"></a>65.2.1.&nbsp;发布软件组件</h3>
        <h5 class="title"><a name="N16FC7"></a>65.2.1.&nbsp;Publishing a Software Component</h5>
       </div>
      </div>
     </div>
     <p> 将 Gradle 项目发布到 Maven 库的最简单方法是指定一个要发布的 <a class="ulink" href="../javadoc/org/gradle/api/component/SoftwareComponent.html" target="_top"><code class="classname">SoftwareComponent</code></a>。目前可用于publication的组件有： <br>The simplest way to publish a Gradle project to a Maven repository is to specify a <a class="ulink" href="../javadoc/org/gradle/api/component/SoftwareComponent.html" target="_top"><code class="classname">SoftwareComponent</code></a> to publish. The components presently available for publication are:</p>
     <div xmlns:xslthl="http://xslthl.sf.net" class="table">
      <p class="title"><b>表65.1. 软件组件 - Table&nbsp;65.1.&nbsp;Software Components</b></p>
      <div class="table-contents">
       <table id="N16FD1">
        <thead>
         <tr> 
          <td>名称<br>Name</td> 
          <td>提供者<br>Provided By</td> 
          <td>工件<br>Artifacts</td> 
          <td>依赖<br>Dependencies</td> 
         </tr>
        </thead>
        <tbody>
         <tr> 
          <td><code class="literal">java</code></td> 
          <td><a class="xref" href="java_plugin.html">第二十三章. <i>Java 插件</i></a><br><a class="xref" href="java_plugin.html">Chapter&nbsp;23, <i>The Java Plugin</i></a></td> 
          <td>生成的 jar 文件<br>Generated jar file</td> 
          <td>“runtime”配置的依赖<br>Dependencies from 'runtime' configuration</td> 
         </tr>
         <tr> 
          <td><code class="literal">web</code></td> 
          <td><a class="xref" href="war_plugin.html">第二十六章. <i>War 插件</i></a><br><a class="xref" href="war_plugin.html">Chapter&nbsp;26, <i>The War Plugin</i></a></td> 
          <td>生成的 war 文件<br>Generated war file</td> 
          <td>没有依赖<br>No dependencies</td> 
         </tr>
        </tbody>
       </table>
      </div>
     </div>
     <p> 在以下示例中，工件和运行时依赖都来自由 <code class="literal">Java Plugin</code> 添加的 “java” 组件。 <br>In the following example, artifacts and runtime dependencies are taken from the `java` component, which is added by the <code class="literal">Java Plugin</code>.</p>
     <div class="example">
      <a name="publishing_maven:publish-component"></a>
      <p class="title"><b>示例 65.2. 为一个java组件添加一个MavenPublication - Example&nbsp;65.2.&nbsp;Adding a MavenPublication for a java component</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">publications {
        mavenJava(MavenPublication) {
            from components.java
        }
    }</pre>
      </div>
     </div>
     <br class="example-break">
    </div>
    <div class="section">
     <div class="titlepage">
      <div>
       <div>
        <h3 class="title"><a name="N17012"></a>65.2.2.&nbsp;发布自定义工件</h3>
        <h5 class="title"><a name="N17012"></a>65.2.2.&nbsp;Publishing custom artifacts</h5>
       </div>
      </div>
     </div>
     <p> 我们还可以显式地配置要被包含在publication的工件。这些工件通常是以原始文件，或者是 <a class="ulink" href="../dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html" target="_top"><code class="classname">AbstractArchiveTask</code></a>的实例（如Jar, Zip）的方式来提供。 <br>It is also possible to explicitly configure artifacts to be included in the publication. Artifacts are commonly supplied as raw files, or as instances of <a class="ulink" href="../dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html" target="_top"><code class="classname">AbstractArchiveTask</code></a> (e.g. Jar, Zip).</p>
     <p> 对于每个自定义工件，可以指定用于发布的<code class="literal">extension</code>和<code class="literal">classifier</code>值。请注意，已发布的工件只有一个可以具有空的classifier，其他所有工件必须有一个唯一的classifier/extension组合。 <br>For each custom artifact, it is possible to specify the <code class="literal">extension</code> and <code class="literal">classifier</code> values to use for publication. Note that only one of the published artifacts can have an empty classifier, and all other artifacts must have a unique classifier/extension combination.</p>
     <p> 如下所示配置自定义工件︰ <br>Configure custom artifacts as follows:</p>
     <div class="example">
      <a name="publishing_maven:publish-custom-artifact"></a>
      <p class="title"><b>示例65.3. 向MavenPublication 添加其他的工件 - Example&nbsp;65.3.&nbsp;Adding additional artifact to a MavenPublication</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">task sourceJar(type: Jar) {
    from sourceSets.main.allJava
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java

            artifact sourceJar {
                classifier <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"sources"</span>
            }
        }
    }
}</pre>
      </div>
     </div>
     <br class="example-break">
     <p> 关于如何自定义工件的更详细的文档，请参阅<a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> 。 <br>See <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> for more detailed documentation on how artifacts can be customized.</p>
    </div>
    <div class="section">
     <div class="titlepage">
      <div>
       <div>
        <h3 class="title"><a name="N17037"></a>65.2.3.&nbsp;生成的POM中的标识值</h3>
        <h5 class="title"><a name="N17037"></a>65.2.3.&nbsp;Identity values in the generated POM</h5>
       </div>
      </div>
     </div>
     <p> 生成的 <code class="literal">POM</code> 文件的属性中，包含了从以下项目属性中获得的标识值： <br>The attributes of the generated <code class="literal">POM</code> file will contain identity values derived from the following project properties:</p>
     <div class="itemizedlist">
      <ul class="itemizedlist">
       <li class="listitem"><code class="literal">groupId</code> - <a class="ulink" href="../dsl/org.gradle.api.Project.html#org.gradle.api.Project:group" target="_top"><code class="classname">Project.getGroup()</code></a></li>
       <li class="listitem"><code class="literal">artifactId</code> - <a class="ulink" href="../dsl/org.gradle.api.Project.html#org.gradle.api.Project:name" target="_top"><code class="classname">Project.getName()</code></a></li>
       <li class="listitem"><code class="literal">version</code> - <a class="ulink" href="../dsl/org.gradle.api.Project.html#org.gradle.api.Project:version" target="_top"><code class="classname">Project.getVersion()</code></a></li>
      </ul>
     </div>
     <p> 重写默认标识值很简单︰只需要配置<code class="literal">MavenPublication</code>时指定<code class="literal">groupId</code>、<code class="literal">artifactId</code>或<code class="literal">version</code>的属性。 <br>Overriding the default identity values is easy: simply specify the <code class="literal">groupId</code>, <code class="literal">artifactId</code> or <code class="literal">version</code> attributes when configuring the <code class="literal">MavenPublication</code>.</p>
     <div class="example">
      <a name="publishing_maven:publish-customize-identity"></a>
      <p class="title"><b>示例 65.4. 自定义发布标识 - Example&nbsp;65.4.&nbsp;customizing the publication identity</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">publishing {
        publications {
            maven(MavenPublication) {
                groupId <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'org.gradle.sample'</span>
                artifactId <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'project1-sample'</span>
                version <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'1.1'</span>

                from components.java
            }
        }
    }</pre>
      </div>
     </div>
     <br class="example-break">
     <div class="tip">
       某些仓库将无法处理所有受支持的字符。例如，当发布到Windows上的文件系统支持的仓库时，就不能将“:” 字符用作标识符。 
     </div>
     <p> Maven 将“groupId”和“artifactId”限制为有限的字符集（<code class="literal">[A-Za-z0-9_\\-.]+</code>），并且 Gradle 强制执行该限制。对于“version”（以及工件的“extension”和“classifier”），只要是有效的Unicode字符，Gradle 都会处理。 <br>Maven restricts 'groupId' and 'artifactId' to a limited character set (<code class="literal">[A-Za-z0-9_\\-.]+</code>) and Gradle enforces this restriction. For 'version' (as well as artifact 'extension' and 'classifier'), Gradle will handle any valid Unicode character.</p>
     <p> 唯一明确禁止使用的 Unicode 值是“”<code class="literal">\</code>”、“<code class="literal">/</code>”以及所有的 ISO 控制字符。提供的值会在发布的早期阶段进行验证。 <br>The only Unicode values that are explicitly prohibited are '<code class="literal">\</code>', '<code class="literal">/</code>' and any ISO control character. Supplied values are validated early in publication.</p>
    </div>
    <div class="section">
     <div class="titlepage">
      <div>
       <div>
        <h3 class="title"><a name="N1707F"></a>65.2.4. 修改生成的 POM</h3>
        <h5 class="title"><a name="N1707F"></a>65.2.4.&nbsp;Modifying the generated POM</h5>
       </div>
      </div>
     </div>
     <p> 有时候，从项目信息生成的 POM 文件需要在发布前进行调整。“<code class="literal">maven-publish</code>”插件提供了一个钩子以允许这样的修改。 <br>At times, the POM file generated from the project information will need to be tweaked before publishing. The “<code class="literal">maven-publish</code>” plugin provides a hook to allow such modification.</p>
     <div class="example">
      <a name="publishing_maven:pom_modification"></a>
      <p class="title"><b>示例 65.5. 修改 POM 文件 - Example&nbsp;65.5.&nbsp;Modifying the POM file</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">publications {
        mavenCustom(MavenPublication) {
            pom.withXml {
                asNode().appendNode(<span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'description'</span>, <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'A demonstration of maven POM customization'</span>)
            }
        }
    }</pre>
      </div>
     </div>
     <br class="example-break">
     <p> 在这个例子中我们为生成的 POM 添加了一个“description”元素。通过这个钩子，你可以修改 POM 的任何方面的内容。例如，你可以把一个依赖的版本范围修改为用于生成构建的实际版本。 <br>In this example we are adding a 'description' element for the generated POM. With this hook, you can modify any aspect of the POM. For example, you could replace the version range for a dependency with the actual version used to produce the build.</p>
     <p> 相关的 API 参考文档，请参阅<a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPom.html#org.gradle.api.publish.maven.MavenPom:withXml(org.gradle.api.Action)" target="_top"><code class="classname">MavenPom.withXml()</code></a> 。 <br>See <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPom.html#org.gradle.api.publish.maven.MavenPom:withXml(org.gradle.api.Action)" target="_top"><code class="classname">MavenPom.withXml()</code></a> for the relevant API reference documentation.</p>
     <p> 如果需要，几乎可以修改所创建POM的任何方面的内容。这意味着，你也可能把一个 POM 修改成无效的 Maven Pom，因此在使用这一功能时必须小心。 <br>It is possible to modify virtually any aspect of the created POM should you need to. This means that it is also possible to modify the POM in such a way that it is no longer a valid Maven Pom, so care must be taken when using this feature.</p>
     <p> 已发布模块的标识符（groupId，artifac，version）则是一个例外；这些值不能在POM中使用“withXML”钩子修改。 <br>The identifier (groupId, artifactId, version) of the published module is an exception; these values cannot be modified in the POM using the `withXML` hook.</p>
    </div>
    <div class="section">
     <div class="titlepage">
      <div>
       <div>
        <h3 class="title"><a name="N1709E"></a>65.2.5. 发布多个模块</h3>
        <h5 class="title"><a name="N1709E"></a>65.2.5.&nbsp;Publishing multiple modules</h5>
       </div>
      </div>
     </div>
     <p> 有时候，不需要创建单独的 Gradle 子项目就能从 Gradle 构建中发布多个模块会很有用。一个例子是为你的库发布一个单独的 API 和实现 jar。使用 Gradle 的话很简单： <br>Sometimes it's useful to publish multiple modules from your Gradle build, without creating a separate Gradle subproject. An example is publishing a separate API and implementation jar for your library. With Gradle this is simple:</p>
     <div class="example">
      <a name="publishing_maven:publish-multiple-publications"></a>
      <p class="title"><b>示例 65.6. 从单项目中发布多个模块 - Example&nbsp;65.6.&nbsp;Publishing multiple modules from a single project</b></p>
      <div class="example-contents">
       <p><code class="filename">build.gradle</code></p>
       <pre class="programlisting">task apiJar(type: Jar) {
        baseName <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"publishing-api"</span>
        from sourceSets.main.output
        exclude <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'**/impl/**'</span>
    }

    publishing {
        publications {
            impl(MavenPublication) {
                groupId <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'org.gradle.sample.impl'</span>
                artifactId <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'project2-impl'</span>
                version <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'2.3'</span>

                from components.java
            }
            api(MavenPublication) {
                groupId <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'org.gradle.sample'</span>
                artifactId <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'project2-api'</span>
                version <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'2'</span>

                artifact apiJar
            }
        }
    }</pre>
      </div>
     </div>
     <br class="example-break">
     <p> 如果一个项目定义了多个发布，那么 Gradle 会将每个发布都发布到定义的仓库中。每个发布都必须x给定如上所述的唯一标识。 <br>If a project defines multiple publications then Gradle will publish each of these to the defined repositories. Each publication must be given a unique identity as described above.</p>
    </div>
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="publishing_maven:repositories"></a>65.3. 仓库</h2>
       <h4 class="title"><a name="publishing_maven:repositories"></a>65.3.&nbsp;Repositories</h4>
      </div>
     </div>
    </div>
    <p> 要发布的内容会被发布到仓库中。要发布到的仓库由 <a class="ulink" href="../dsl/org.gradle.api.publish.PublishingExtension.html#org.gradle.api.publish.PublishingExtension:repositories" target="_top"><code class="classname">PublishingExtension.getRepositories()</code></a> 容器定义。 <br>Publications are published to repositories. The repositories to publish to are defined by the <a class="ulink" href="../dsl/org.gradle.api.publish.PublishingExtension.html#org.gradle.api.publish.PublishingExtension:repositories" target="_top"><code class="classname">PublishingExtension.getRepositories()</code></a> container.</p>
    <div class="example">
     <a name="publishing_maven:repositories"></a>
     <p class="title"><b>示例 65.7. 声明要发布到的仓库 - Example&nbsp;65.7.&nbsp;Declaring repositories to publish to</b></p>
     <div class="example-contents">
      <p><code class="filename">build.gradle</code></p>
      <pre class="programlisting">repositories {
        maven {
            url <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"$buildDir/repo"</span> <span xmlns:xslthl="http://xslthl.sf.net" class="hl-comment">// change to point to your repo, e.g. http://my.org/repo</span>
        }
    }</pre>
     </div>
    </div>
    <br class="example-break">
    <p> 用于声明要发布的仓库的 DSL 与用于声明查找依赖的仓库的DSL一样，都是使用 <a class="ulink" href="../dsl/org.gradle.api.artifacts.dsl.RepositoryHandler.html" target="_top"><code class="classname">RepositoryHandler</code></a>。但是，在 Maven 发布的场景中，只有 <a class="ulink" href="../dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html" target="_top"><code class="classname">MavenArtifactRepository</code></a> 仓库才可以用于发布。 <br>The DSL used to declare repositories for publication is the same DSL that is used to declare repositories to consume dependencies from, <a class="ulink" href="../dsl/org.gradle.api.artifacts.dsl.RepositoryHandler.html" target="_top"><code class="classname">RepositoryHandler</code></a>. However, in the context of Maven publication only <a class="ulink" href="../dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html" target="_top"><code class="classname">MavenArtifactRepository</code></a> repositories can be used for publication.</p>
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="publishing_maven:publishing"></a>65.4. 执行发布</h2>
       <h4 class="title"><a name="publishing_maven:publishing"></a>65.4.&nbsp;Performing a publish</h4>
      </div>
     </div>
    </div>
    <p> 对每一个在 <code class="literal">publishing.publications</code> 和 <code class="literal">publishing.repositories</code> 容器中分别组合的<a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> 和 <a class="ulink" href="../dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html" target="_top"><code class="classname">MavenArtifactRepository</code></a>，“<code class="literal">maven-publish</code>” 插件自动为它们创建了一个 <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html" target="_top"><code class="classname">PublishToMavenRepository</code></a> 任务。 <br>The “<code class="literal">maven-publish</code>” plugin automatically creates a <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html" target="_top"><code class="classname">PublishToMavenRepository</code></a> task for each <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> and <a class="ulink" href="../dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html" target="_top"><code class="classname">MavenArtifactRepository</code></a> combination in the <code class="literal">publishing.publications</code> and <code class="literal">publishing.repositories</code> containers respectively.</p>
    <p> 这个创建的任务使用“<code class="literal">publish«<span class="emphasis"><em>PUBLICATION 名称</em></span>»PublicationTo«<span class="emphasis"><em>REPOSITORY 名称</em></span>»Repository</code>”的模式来命名。 <br>The created task is named using the pattern "<code class="literal">publish«<span class="emphasis"><em>NAME OF PUBLICATION</em></span>»PublicationTo«<span class="emphasis"><em>NAME OF REPOSITORY</em></span>»Repository</code>".</p>
    <div class="example">
     <a name="publishingMavenPublishMinimal"></a>
     <p class="title"><b>示例 65.8. 将项目发布到 Maven 仓库 - Example&nbsp;65.8.&nbsp;Publishing a project to a Maven repository</b></p>
     <div class="example-contents">
      <p><code class="filename">build.gradle</code></p>
      <pre class="programlisting">apply plugin: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'java'</span>
apply plugin: <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'maven-publish'</span>

group = <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'org.gradle.sample'</span>
version = <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">'1.0'</span>

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
        }
    }
    repositories {
        maven {
            url <span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"$buildDir/repo"</span> <span xmlns:xslthl="http://xslthl.sf.net" class="hl-comment">// change to point to your repo, e.g. http://my.org/repo</span>
        }
    }
}</pre>
      <p><strong class="userinput"><code>gradle publish</code></strong>的输出结果<br>Output of <strong class="userinput"><code>gradle publish</code></strong></p>
      <pre class="screen">&gt; gradle publish
:generatePomFileForMavenJavaPublication
:compileJava
:processResources UP-TO-DATE
:classes
:jar
:publishMavenJavaPublicationToMavenRepository
:publish

BUILD SUCCESSFUL

Total time: 1 secs</pre>
     </div>
    </div>
    <br class="example-break">
    <p> 因此，在这个例子中，添加了一个 <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html" target="_top"><code class="classname">PublishToMavenRepository</code></a> 任务，命名为“ <code class="literal">publishMavenJavaPublicationToMavenRepository</code>”，这个任务会被连接到<code class="literal">publish</code>生命周期任务中。执行 <code class="literal">gradle publish</code>会构建 POM 文件和所有要发布的工件，并将它们传到仓库。 <br>So in this example a single <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html" target="_top"><code class="classname">PublishToMavenRepository</code></a> task is be added, named '<code class="literal">publishMavenJavaPublicationToMavenRepository</code>'. This task is wired into the <code class="literal">publish</code> lifecycle task. Executing <code class="literal">gradle publish</code> builds the POM file and all of the artifacts to be published, and transfers them to the repository.</p>
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="publishing_maven:install"></a>65.5. 发布到Maven本地库</h2>
       <h4 class="title"><a name="publishing_maven:install"></a>65.5.&nbsp;Publishing to Maven Local</h4>
      </div>
     </div>
    </div>
    <p> 为了与本地 Maven 安装集成，有时将模块发布到本地 .m2 仓库中会很有用。在 Maven 用语中，这称为“安装”模块。“<code class="literal">maven-publish</code>”插件通过为<code class="literal">publishing.publications</code>容器中的每个<a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a>任务，自动创建一个<a class="ulink" href="../javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html" target="_top"><code class="classname">PublishToMavenLocal</code></a>任务，使得它很容易实现。其中每一个任务都连接到<code class="literal">publishToMavenLocal</code>生命周期任务中。你不需要在“publishing.repositories”代码段中使用“mavenLocal”。 <br>For integration with a local Maven installation, it is sometimes useful to publish the module into the local .m2 repository. In Maven parlance, this is referred to as 'installing' the module. The “<code class="literal">maven-publish</code>” plugin makes this easy to do by automatically creating a <a class="ulink" href="../javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html" target="_top"><code class="classname">PublishToMavenLocal</code></a> task for each <a class="ulink" href="../dsl/org.gradle.api.publish.maven.MavenPublication.html" target="_top"><code class="classname">MavenPublication</code></a> in the <code class="literal">publishing.publications</code> container. Each of these tasks is wired into the <code class="literal">publishToMavenLocal</code> lifecycle task. You do not need to have `mavenLocal` in your `publishing.repositories` section.</p>
    <p> 这个创建的任务使用“<code class="literal">publish«<span class="emphasis"><em>PUBLICATION 名称</em></span>»PublicationToMavenLocal</code>”的模式来命名。 <br>The created task is named using the pattern "<code class="literal">publish«<span class="emphasis"><em>NAME OF PUBLICATION</em></span>»PublicationToMavenLocal</code>".</p>
    <div class="example">
     <a name="publishingMavenPublishLocal"></a>
     <p class="title"><b>示例 65.9. 发布项目到 Maven 本地仓库 - Example&nbsp;65.9.&nbsp;Publish a project to the Maven local repository</b></p>
     <div class="example-contents">
      <p><strong class="userinput"><code>gradle publishToMavenLocal</code></strong>的输出结果<br>Output of <strong class="userinput"><code>gradle publishToMavenLocal</code></strong></p>
      <pre class="screen">&gt; gradle publishToMavenLocal
:generatePomFileForMavenJavaPublication
:compileJava
:processResources UP-TO-DATE
:classes
:jar
:publishMavenJavaPublicationToMavenLocal
:publishToMavenLocal

BUILD SUCCESSFUL

Total time: 1 secs</pre>
     </div>
    </div>
    <br class="example-break">
    <p> 因此，在这个示例中，你可以看到添加了一个名为“<a class="ulink" href="../javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html" target="_top"><code class="classname">publishMavenJavaPublicationToMavenLocal</code></a>”的<code class="literal">PublisheToMavenLocal</code>任务。这个任务连接到<code class="literal">publishToMavenLocal</code>生命周期任务中。执行 <code class="literal">gradle publishToMavenLocal</code> 会构建 POM 文件和所有要发布的工件，并将它们“安装”到本地 Maven 仓库中。 <br>So in this example you can see that a single <a class="ulink" href="../javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html" target="_top"><code class="classname">PublishToMavenLocal</code></a> task is be added, named '<code class="literal">publishMavenJavaPublicationToMavenLocal</code>'. This task is wired into the <code class="literal">publishToMavenLocal</code> lifecycle task. Executing <code class="literal">gradle publishToMavenLocal</code> builds the POM file and all of the artifacts to be published, and 'installs' them into the local Maven repository.</p>
   </div>
   <div class="section">
    <div class="titlepage">
     <div>
      <div>
       <h2 class="title"><a name="publishing_maven:generate-pom"></a>65.6. 生成POM文件而不发布</h2>
       <h4 class="title"><a name="publishing_maven:generate-pom"></a>65.6.&nbsp;Generating the POM file without publishing</h4>
      </div>
     </div>
    </div>
    <p> 有时候我们会需要在实际上不发布的情况下，为模块生成一个 Maven POM 文件。由于POM生成是由单独的任务执行的，因此这样做很简单。 <br>At times it is useful to generate a Maven POM file for a module without actually publishing. Since POM generation is performed by a separate task, it is very easy to do so.</p>
    <p> 生成 POM 文件的任务为 <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.GenerateMavenPom.html" target="_top"><code class="classname">GenerateMavenPom</code></a> 类型，并且根据发布的名称它被命名为：“<code class="literal">generatePomFileFor«<span class="emphasis"><em>PUBLICATION 的名称</em></span>»发布</code>”。因此，在下面的示例中，如果发布名为“<code class="literal">mavenCustom</code>”，则任务将命名为“<code class="literal">generatePomFileForMavenCustomPublication</code>”。 <br>The task for generating the POM file is of type <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.GenerateMavenPom.html" target="_top"><code class="classname">GenerateMavenPom</code></a>, and it is given a name based on the name of the publication: "<code class="literal">generatePomFileFor«<span class="emphasis"><em>NAME OF PUBLICATION</em></span>»Publication</code>". So in the example below, where the publication is named "<code class="literal">mavenCustom</code>", the task will be named "<code class="literal">generatePomFileForMavenCustomPublication</code>".</p>
    <div class="example">
     <a name="publishingMavenGeneratePom"></a>
     <p class="title"><b>示例 65.10.&nbsp;生成POM文件而不发布 - Example&nbsp;65.10.&nbsp;Generate a POM file without publishing</b></p>
     <div class="example-contents">
      <p><code class="filename">build.gradle</code></p>
      <pre class="programlisting">model {
    tasks.generatePomFileForMavenCustomPublication {
        destination = file(<span xmlns:xslthl="http://xslthl.sf.net" class="hl-string">"$buildDir/generated-pom.xml"</span>)
    }
}</pre>
      <p><strong class="userinput"><code>gradle generatePomFileForMavenCustomPublication</code></strong>的输出结果<br>Output of <strong class="userinput"><code>gradle generatePomFileForMavenCustomPublication</code></strong></p>
      <pre class="screen">&gt; gradle generatePomFileForMavenCustomPublication
:generatePomFileForMavenCustomPublication

BUILD SUCCESSFUL

Total time: 1 secs</pre>
     </div>
    </div>
    <br class="example-break">
    <p> 发布模型的所有细节仍然要在 POM 生成中考虑，包括<code class="literal">compon</code>，自定义<code class="literal">artifacts</code>，以及通过<code class="literal">pom.withXml</code>所做的任何修改。 <br>All details of the publishing model are still considered in POM generation, including <code class="literal">components</code>`, custom <code class="literal">artifacts</code>, and any modifications made via <code class="literal">pom.withXml</code>.</p>
    <div class="note">
     <p> “<code class="literal">maven-publish</code>”插件利用了后期插件配置的一些实验性的支持，在发布扩展配置前，不会构造 <code class="literal">GenerateMavenPom</code> 任务。确保在你尝试访问 <code class="literal">GenerateM</code> 任务时，发布插件已经配置的最简单的方法是将访问放在 <code class="literal">publishing</code> 块中，如上面的例子中所示。 <br>The “<code class="literal">maven-publish</code>” plugin leverages some experimental support for late plugin configuration, and any <code class="literal">GenerateMavenPom</code> tasks will not be constructed until the publishing extension is configured. The simplest way to ensure that the publishing plugin is configured when you attempt to access the <code class="literal">GenerateMavenPom</code> task is to place the access inside a <code class="literal">publishing</code> block, as the example above demonstrates.</p>
     <p> 这同样适用于尝试访问发布内容相关的任务（如 <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html" target="_top"><code class="classname">PublishToMavenRepository</code></a>）。这些任务应该在 <code class="literal">publishing</code> 块中引用。 <br>The same applies to any attempt to access publication-specific tasks like <a class="ulink" href="../dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html" target="_top"><code class="classname">PublishToMavenRepository</code></a>. These tasks should be referenced from within a <code class="literal">publishing</code> block.</p>
    </div>
   </div>
  </div>
  <div class="navfooter">
   <div>
    <div class="navbar">
     <a xmlns:xslthl="http://xslthl.sf.net" href="publishing_ivy.html" title="第六十四章. Ivy发布（新）">上一章</a>
     <span>|</span>
     <a xmlns:xslthl="http://xslthl.sf.net" href="userguide.html" title="Gradle 用户指南">目录</a>
     <span>|</span>
     <a xmlns:xslthl="http://xslthl.sf.net" href="sample_list.html" title="附录&nbsp;A.&nbsp;Gradle 示例">下一章</a>
    </div>
   </div>
  </div>
 </body>
</html>